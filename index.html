<!DOCTYPE html><html><head><meta charset="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><title>看板导航</title><link href="css/zxmk.css" rel="stylesheet" type="text/css"/><script src="js/jquery-1.8.3.min.js" type="text/javascript"></script></head><body><div class="top-nav">  <div class="w1000 clearfix">    <div class="topLogo"><img src="images/xx-logo.png"  alt="logo"/></div>    <div class="topLogin"><a href="http://home.drive-inno.com/">主页</a>┊<a href="http://mes.drive-inno.com/">mes</a>┊<a href="#" id="ip"></a> </div>  </div></div><div class="index-con" style="z-index: 0">  <ul>    <li class="in-kct in-course"> <a href="./total.html" title="汇总">      <div class="in-block"> <i class="bigger"></i> <span class="ch show" style="display: block;">数据汇总</span> <i class="in-none"></i> <span class="in-text" style="display: none;">        <p><em>浙江创驱</em>&nbsp;&nbsp;看板数据汇总</p>        </span> </div>      </a> </li>    <li class="in-kct in-quest"> <a href="./line.html?cost_type=3305" title="电控总装">      <div class="in-block"> <i class=""></i> <span class="ch" style="display: inline;">电控总装</span> <i class="in-none"></i> <span class="in-text" style="display: none; width: 280px; left: 30px">        <p><em>电控</em>VPU<em>HVB</em>CDU</p>        <p>让你的水平提<em>升更容易</em>！</p>        </span> </div>      </a> </li>    <li class="in-jbk in-plan"> <a href="./line.html?cost_type=3302" title="贴片车间">      <div class="in-block"> <i style="display: block;"></i> <span style="display: inline;">贴片车间</span> <i class="in-none toLeft1" style="display: none;"></i> <span class="in-text" style="display: none;">        <p>贴片车间</p>        <p>贴片车间</p>        </span> </div>      </a> </li>    <li class="in-jbk in-report"> <a href="./line.html?cost_type=3307" title="电机">      <div class="in-block"> <i style="display: block;"></i> <span style="display: inline;">电机</span> <i class="in-none toLeft2" style="display: none;"></i> <span class="in-text" style="display: none;">        <p>电机</p>        <p>电机</p>        </span> </div>      </a> </li>    <li class="in-zxl in-forma"> <a href="#" title="精选试题">      <div class="in-block"> <i style="display: block;"></i> <span style="display: inline;">精选试题</span> <i class="in-none toLeft0 toLeft4" style="display: none;"></i> <span class="in-text" style="display: none;">        <p>更简洁、更简单、更强大、更专业</p>        </span> </div>      </a> </li>    <li class="in-zxl in-means"> <a href="#" title="资料">      <div class="in-block"> <i></i> <span>资料</span> <i class="in-none"></i> <span class="in-text">        <p>辅导资料、常用软件</p>        <p>应有尽有</p>        </span> </div>      </a> </li>    <li class="in-jbk in-client"> <a href="#" target="_blank" title="微社区">      <div class="in-block"> <i></i> <span id="tag_title" style="font-size:24px;"></span> <span class="in-text">        </span> </div>      </a> </li>  </ul></div><script>$(function () {    var mIp = getIp('http://mes.drive-inno.com/mes/api/getIp');    var lockReconnect = false;//避免重复连接    var ws = null; //WebSocket的引用    var wsUrl = "ws://10.10.5.25:9900"; //这个要与后端提供的相同    $('#ip').html(`IP: ${mIp}`);    function createWebSocket(){        try {            ws = new WebSocket(wsUrl);            initEventHandle();        } catch (e) {            reconnect(wsUrl);        }    }    function reconnect(url) {        if(lockReconnect) return;        lockReconnect = true;        //没连接上会一直重连，设置延迟避免请求过多        setTimeout(function () {            createWebSocket(wsUrl);            $('#tag_title').html('try reconnect');            lockReconnect = false;        }, 5000); //这里设置重连间隔(ms)    }     /*********************初始化开始**********************/    function initEventHandle() {        ws.onopen = function() {            if(mIp) {                $('#tag_title').html('ok');                ws.send(JSON.stringify({controller:'Index',action:'hello',params:{ip:mIp}}));            } else {                $('#tag_title').html('无法获取IP');            }            heartCheck.reset().start();//心跳检测重置        }        // 收到服务器消息后响应        ws.onmessage = function(e) {            console.log(e.data);            heartCheck.reset().start();//如果获取到消息，心跳检测重置 拿到任何消息都说明当前连接是正常的            if(e.data !== 'PONG') {                var res = eval('(' + e.data + ')');                if(res.case === 'jump' && res.data.url)                    window.location.href = res.data.url;            }        }        ws.onclose = function() {            $('#tag_title').html('server close');            reconnect(wsUrl);        }        ws.onerror = function () {            $('#tag_title').html('server err');            reconnect(wsUrl);        };    }    //心跳检测    var heartCheck = {        timeout: 5000,//毫秒        timeoutObj: null,        serverTimeoutObj: null,        reset: function(){            clearTimeout(this.timeoutObj);            clearTimeout(this.serverTimeoutObj);            return this;        },        start: function(){            var self = this;            this.timeoutObj = setTimeout(function(){                //这里发送一个心跳，后端收到后，返回一个心跳消息，onmessage拿到返回的心跳就说明连接正常                ws.send("PING");                self.serverTimeoutObj = setTimeout(function(){//如果超过一定时间还没重置，说明后端主动断开了                }, self.timeout)            }, this.timeout)        }    }    function getIp(url){        var mIp = '';    // 先定义个值，方便下面赋值        $.ajax({             async:false,    // 这个需要写上             url:url,             type:'post',             dataType:'json',             data:{},             success:function (res) {                 mIp = res.data;   // 赋值给刚才定义的值             }        });        return mIp    }    createWebSocket(wsUrl);/**启动连接**/    $(".index-con .in-kct").hover(function() {        $(this).find('i:first').addClass('smaller').removeClass('bigger')        $(this).find('span:first').fadeOut('')        $(this).find('.in-text').show('fast').addClass('show')        $(this).find('.ch').removeClass('')    }, function() {        $(this).find('i:first').removeClass('smaller').addClass('bigger')        $(this).find('span:first').fadeIn('')        $(this).find('.in-text').hide('').removeClass('fast')        $(this).find('.ch').addClass('show')    })    $(".index-con .in-jbk").hover(function() {        $(this).find('i:first').addClass('hide')        $(this).find('span:first').hide('')        $(this).find('.in-text').show('').addClass('show')        var num = $(this).index('.in-jbk') + 1;        $(this).find('.in-none').show('').addClass('toLeft' + num).removeClass('toRight' + num)        $(this).find('.ch1').removeClass('show')    }, function() {        $(this).find('i:first').addClass('hide')        $(this).find('span:first').fadeIn('')        $(this).find('.in-text').hide('').removeClass('show')        var num = $(this).index('.in-jbk') + 1;        $(this).find('.in-none').show().addClass('toRight' + num).removeClass('toLeft' + num)        $(this).find('.ch1').addClass('show')    })    $(".index-con .in-zxl").hover(function() {        $(this).find('i:first').addClass('hide')        $(this).find('span:first').hide('')        $(this).find('.in-text').show().addClass('show')        var nums = $(this).index('.in-zxl') + 1;        $(this).find('.in-none').show().addClass('toLeft4').removeClass('toRight4')        $(this).find('.ch2').removeClass('show')    }, function() {        $(this).find('i:first').addClass('hide')        $(this).find('span:first').fadeIn('fast')        $(this).find('.in-text').hide().removeClass('show')        $(this).find('.in-none').show().addClass('toRight4').removeClass('toLeft4')        $(this).find('.ch2').addClass('show')    });});</script></body></html>